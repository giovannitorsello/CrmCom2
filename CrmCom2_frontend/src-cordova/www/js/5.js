(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{2963:function(t,e,a){},6803:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"contracts"}},[a("h6",[t._v("\n    Gestione contratti\n    "),a("strong",[t._v(t._s(t.customerDescription))])]),a("img",{staticStyle:{width:"48px",height:"48px"},attrs:{src:"/img/actions/new.png"},on:{click:t.newContract}}),a("img",{staticStyle:{width:"48px",height:"48px"},attrs:{src:"/img/actions/save.png"},on:{click:t.saveContract}}),a("img",{staticStyle:{width:"48px",height:"48px"},attrs:{src:"/img/actions/delete.png"},on:{click:t.deleteContract}}),a("img",{staticStyle:{width:"48px",height:"48px"},attrs:{src:"/img/actions/exit.png"},on:{click:t.exit}}),a("q-form",{ref:"contractForm",staticClass:"q-gutter-md"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[a("q-input",{attrs:{label:"Descrizione"},model:{value:t.selectedContract.description,callback:function(e){t.$set(t.selectedContract,"description",e)},expression:"selectedContract.description"}}),a("q-input",{attrs:{label:"Indirizzo"},model:{value:t.selectedContract.address,callback:function(e){t.$set(t.selectedContract,"address",e)},expression:"selectedContract.address"}})],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[a("q-input",{attrs:{label:"Durata"},model:{value:t.selectedContract.duration,callback:function(e){t.$set(t.selectedContract,"duration",e)},expression:"selectedContract.duration"}}),a("q-checkbox",{attrs:{label:"Rinnovo Automatico"},model:{value:t.selectedContract.automaticRenew,callback:function(e){t.$set(t.selectedContract,"automaticRenew",e)},expression:"selectedContract.automaticRenew"}}),a("q-checkbox",{attrs:{label:"Da fatturare"},model:{value:t.selectedContract.businnessFlag,callback:function(e){t.$set(t.selectedContract,"businnessFlag",e)},expression:"selectedContract.businnessFlag"}})],1)])]),a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[a("q-select",{attrs:{filled:"",label:"Modelli di servizio",options:t.optionsServiceTemplates},model:{value:t.serviceTemplate,callback:function(e){t.serviceTemplate=e},expression:"serviceTemplate"}}),a("div",{staticClass:"col"},[a("img",{staticStyle:{width:"32px",height:"32px",xfill:"greenyellow"},attrs:{src:"/img/actions/new.png",alt:"seleziona"},on:{click:function(e){return t.addService()}}})])],1)]),t.services?a("div",[a("q-table",{attrs:{title:"Servizi associati al contratto",data:t.services,columns:t.columnsTableServices,"row-key":"id","virtual-scroll":"",pagination:t.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(e){t.pagination=e},"row-click":t.openService},scopedSlots:t._u([{key:"header",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-th",{attrs:{"auto-width":""}}),t._l(e.cols,(function(i){return a("q-th",{key:i.name,attrs:{props:e}},[t._v(t._s(i.label))])}))],2)]}},{key:"body",fn:function(e){return[a("q-tr",{class:e.row.state,attrs:{props:e}},[a("q-td",{attrs:{"auto-width":""}},[a("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:"/img/actions/open.png"},on:{click:function(a){return t.openService(e.row)}}}),a("img",{staticStyle:{width:"32px",height:"32px",xfill:"green"},attrs:{src:"/img/actions/unlocked.png"},on:{click:function(a){return t.activateService(e.row)}}}),a("img",{staticStyle:{width:"32px",height:"32px",xfill:"red"},attrs:{src:"/img/actions/locked.png"},on:{click:function(a){return t.suspendService(e.row)}}}),a("img",{staticStyle:{width:"32px",height:"32px",xfill:"gray"},attrs:{src:"/img/actions/delete.png"},on:{click:function(a){return t.deleteService(e.row)}}})]),t._l(e.cols,(function(i){return a("q-td",{key:i.name,attrs:{props:e}},[t._v(t._s(i.value))])}))],2)]}}],null,!1,1052261802)})],1):t._e(),t.devices?a("div",[a("q-table",{attrs:{title:"Dispositivi associati al contratto",data:t.devices,columns:t.columnsTableDevices,"row-key":"id","virtual-scroll":"",pagination:t.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(e){t.pagination=e},"row-click":t.openDevice},scopedSlots:t._u([{key:"header",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-th",{attrs:{"auto-width":""}}),t._l(e.cols,(function(i){return a("q-th",{key:i.name,attrs:{props:e}},[t._v(t._s(i.label))])}))],2)]}},{key:"body",fn:function(e){return[a("q-tr",{class:e.row.state,attrs:{props:e}},[a("q-td",{attrs:{"auto-width":""}},[a("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:"/img/actions/open.png"},on:{click:function(a){return t.openDevice(e.row)}}}),a("img",{staticStyle:{width:"32px",height:"32px",xfill:"green"},attrs:{src:"/img/actions/unlocked.png"},on:{click:function(a){return t.activateDevice(e.row)}}}),a("img",{staticStyle:{width:"32px",height:"32px",xfill:"red"},attrs:{src:"/img/actions/locked.png"},on:{click:function(a){return t.suspendDevice(e.row)}}}),a("img",{staticStyle:{width:"32px",height:"32px",xfill:"gray"},attrs:{src:"/img/actions/delete.png"},on:{click:function(a){return t.deleteDevice(e.row)}}})]),t._l(e.cols,(function(i){return a("q-td",{key:i.name,attrs:{props:e}},[t._v(t._s(i.value))])}))],2)]}}],null,!1,2529122442)})],1):t._e()],1)},s=[],c=(a("e01a"),a("c973")),o=a.n(c),n=a("2f62"),r={data(){return{selectedContract:{},selectedService:{},serviceTemplate:{},contracts:[],devices:[],services:[],serviceTemplates:[],optionsServiceTemplates:[],pagination:{rowsPerPage:0},columnsTableServices:[{name:"actions",label:"Azioni"},{name:"state",label:"Stato",field:t=>t.state,sortable:!0},{name:"description",label:"Descrizione",field:t=>t.service_description,sortable:!0},{name:"price",label:"Prezzo",field:t=>t.price},{name:"vat",label:"IVA",field:t=>t.vat}],columnsTableDevices:[{name:"actions",label:"Azioni"},{name:"Stato",label:"state",field:t=>"monitored"===t.monitored?t.state+" ("+t.monitored+")":t.state},{name:"description",label:"Descrizione",field:t=>t.description,sortable:!0},{name:"asset",label:"Asset",field:t=>t.companyasset+"("+t.techasset+")",sortable:!0},{name:"type",label:"Tipologia",field:t=>t.type,sortable:!0},{name:"model",label:"Modello",field:t=>t.model,sortable:!0},{name:"ipv4",label:"Ip",field:t=>t.ipv6?t.ipv6:t.ipv4,sortable:!0},{name:"mac",label:"Mac",field:t=>t.mac}]}},methods:{getContractData(){this.$store;this.selectedContract=Object.assign({},this.$store.state.contract),this.getServiceTemplates(),this.getContractServices(),this.getContractDevices()},getServiceTemplates(){this.$store;this.$axios.post("/adminarea/serviceTemplate/getall",{}).then(t=>{"OK"===t.data.status&&(this.serviceTemplates=t.data.serviceTemplates,this.populateSelectServiceTemplates())}).catch(t=>{console.log(t)})},getContractServices(){this.$store,this.$parent;this.$axios.post("/adminarea/contractService/get_all_by_contract",{idContract:this.selectedContract.id}).then(t=>{"OK"===t.data.status&&(this.services=t.data.services)}).catch(t=>{console.log(t)})},getContractDevices(){this.$store,this.$parent;this.$axios.post("/adminarea/deviceCustomer/get_all_by_contract",{idContract:this.selectedContract.id}).then(t=>{"OK"===t.data.status&&(this.devices=t.data.devicesCustomer)}).catch(t=>{console.log(t)})},addService(){var t=this.serviceTemplate.value.id;t&&this.selectedContract.id&&this.$axios.post("/adminarea/contractService/insert",{idServiceTemplate:t,idContract:this.selectedContract.id}).then(t=>{"OK"===t.data.status&&(this.selectedService=t.data.service,this.$store.commit("changeService",this.selectedService),this.makeToast(t.data.msg),this.services.push(this.selectedService))}).catch(t=>{console.log(t)})},openService(t){this.$store.commit("changeService",t),this.$router.push("/ServiceContract")},activateService(t){t.state="active",this.$axios.post("/adminarea/contractService/update",{service:t}).then(t=>{"OK"===t.data.status&&this.makeToast("Servizio attivo")}).catch(t=>{console.log(t)})},suspendService(t){t.state="suspended",this.$axios.post("/adminarea/contractService/update",{service:t}).then(t=>{"OK"===t.data.status&&this.makeToast("Servizio sospeso")}).catch(t=>{console.log(t)})},deleteService(t){const e=confirm("Confermi la cancellazione?");e&&this.$axios.post("adminarea/contractService/delete",{idContractService:t.id}).then(t=>{"OK"===t.data.status&&(this.makeToast("Servizio eliminato"),this.getContractServices())}).catch(t=>{console.log(t)})},openDevice(t){t.state="active",this.selectedDevice=t,this.$store.commit("changeDeviceCustomer",this.selectedDevice),this.$router.push("/DeviceCustomer")},activateDevice(t){t.state="active",this.$axios.post("/adminarea/deviceCustomer/update",{device:t}).then(t=>{"OK"===t.data.status&&this.makeToast("Dispositivo attivo")}).catch(t=>{console.log(t)})},suspendDevice(t){t.state="suspended",this.$axios.post("/adminarea/deviceCustomer/update",{device:t}).then(t=>{"OK"===t.data.status&&this.makeToast("Dispositivo sospeso")}).catch(t=>{console.log(t)})},deleteDevice(t){const e=confirm("Confermi la cancellazione?");return e?(console.log("Delete confirmed"),"cancellato"):""},newContract(){var t=this;return o()((function*(){t.services={},t.devices={};const e=!0;e?(t.selectedContract.customerId=t.customer.id,t.$axios.post("/adminarea/contract/insert",{contract:t.selectedContract}).then(e=>{"OK"===e.data.status&&(alert("Contratto inserito correttamente"),t.selectedContract=e.data.contract,t.$store.commit("changeContract",t.selectedContract),t.makeToast(e.data.msg),t.getContractData())}).catch(t=>{console.log(t)})):alert("Dati errati controlla i campi inseriti")}))()},saveContract(){var t=this;return o()((function*(){const e=!0;e?t.$axios.post("/adminarea/contract/update",{contract:t.selectedContract}).then(e=>{"OK"===e.data.status&&(t.selectedContract=e.data.contract,t.$store.commit("changeContract",t.selectedContract),t.makeToast(e.data.msg),t.getContractData())}).catch(t=>{console.log(t)}):alert("Dati errati controlla i campi inseriti")}))()},deleteContract:function(){const t=confirm("Confermi la cancellazione?");t&&this.$axios.post("adminarea/contract/delete",{contract:this.selectedContract}).then(t=>{"OK"===t.data.status&&(this.selectedContract=t.data.contract,this.$store.commit("changeContract",this.selectedContract),this.makeToast(t.data.msg),this.getContractData())}).catch(t=>{console.log(t)})},populateSelectServiceTemplates(){this.optionsServiceTemplates=[],this.serviceTemplates.forEach((t,e,a)=>{this.optionsServiceTemplates.push({label:t.description+"---"+t.price+"€",value:t,description:"Modello di servizio predefinito"})})},exit:function(){this.$router.push("/Customer")},makeToast(t){this.$q.notify({color:"green-4",textColor:"white",icon:"info",message:t})}},computed:Object(n["b"])({user:"user",customer:"customer",customerDescription(){const t=this.customer;return t.vatcode&&""!==t.vatcode?t.company:t.lastname+" "+t.firstname}}),mounted(){this.getContractData()},created(){}},l=r,d=(a("f59c"),a("2877")),p=a("0378"),m=a("27f9"),u=a("8f8e"),h=a("ddd8"),v=a("eaac"),g=a("bd08"),f=a("357e"),C=a("db86"),b=a("eebe"),S=a.n(b),x=Object(d["a"])(l,i,s,!1,null,"382bc2a0",null);e["default"]=x.exports;S()(x,"components",{QForm:p["a"],QInput:m["a"],QCheckbox:u["a"],QSelect:h["a"],QTable:v["a"],QTr:g["a"],QTh:f["a"],QTd:C["a"]})},f59c:function(t,e,a){"use strict";var i=a("2963"),s=a.n(i);s.a}}]);