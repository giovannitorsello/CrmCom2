(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"203f":function(e,t,s){},"39d9":function(e,t,s){"use strict";s("203f")},a47a:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"device"}},[i("h6",[e._v("\n    Gestione dispositivi\n  ")]),i("p",[i("strong",[e._v("Cliente: "+e._s(e.customerDescription))]),i("br"),i("strong",[e._v("Contratto: "+e._s(e.selectedContract.id))]),i("br"),i("strong",[e._v("Ip disponibili: \n        "),e._l(e.freeIps,(function(t){return i("div",{key:t},[i("span",{on:{click:function(s){return e.selectIpv4(t)}}},[e._v("---\x3e "+e._s(t))])])}))],2)]),i("img",{staticStyle:{width:"48px",height:"48px"},attrs:{src:s("f32a")},on:{click:e.newDevice}}),i("img",{staticStyle:{width:"48px",height:"48px"},attrs:{src:s("40b4")},on:{click:e.saveDevice}}),i("img",{staticStyle:{width:"48px",height:"48px"},attrs:{src:s("c8ed")},on:{click:e.deleteDevice}}),i("img",{class:e.monitorClassBackground,staticStyle:{width:"48px",height:"48px"},attrs:{src:s("ca9b")},on:{click:e.monitorDevice}}),i("img",{staticStyle:{width:"48px",height:"48px"},attrs:{src:s("5df3")},on:{click:e.exit}}),i("ValidationObserver",{ref:"FormDeviceCustomer"},[i("q-form",{ref:"deviceForm",staticClass:"q-gutter-md"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("ValidationProvider",{attrs:{name:"Tecnologia",immediate:"",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[i("q-select",{attrs:{filled:"",label:"Asset",options:e.selectAssetOptions,"map-options":"","option-label":"label","option-value":"value"},on:{input:e.changeAsset},model:{value:e.selectedAsset,callback:function(t){e.selectedAsset=t},expression:"selectedAsset"}}),i("span",{staticClass:"error"},[e._v(e._s(s[0]))])]}}])})],1)]),i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("ValidationProvider",{attrs:{name:"Descrizione",immediate:"",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[i("q-input",{attrs:{label:"Descrizione"},model:{value:e.selectedDevice.description,callback:function(t){e.$set(e.selectedDevice,"description",t)},expression:"selectedDevice.description"}}),i("span",{staticClass:"error"},[e._v(e._s(s[0]))])]}}])})],1),i("div",{staticClass:"col"},[i("ValidationProvider",{attrs:{name:"Tipo",immediate:"",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[i("q-input",{attrs:{label:"Tipo"},model:{value:e.selectedDevice.type,callback:function(t){e.$set(e.selectedDevice,"type",t)},expression:"selectedDevice.type"}}),i("span",{staticClass:"error"},[e._v(e._s(s[0]))])]}}])})],1),i("div",{staticClass:"col"}),i("div",{staticClass:"col"},[i("ValidationProvider",{attrs:{name:"Produttore",immediate:"",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[i("q-input",{attrs:{label:"Produttore"},model:{value:e.selectedDevice.vendor,callback:function(t){e.$set(e.selectedDevice,"vendor",t)},expression:"selectedDevice.vendor"}}),i("span",{staticClass:"error"},[e._v(e._s(s[0]))])]}}])})],1),i("div",{staticClass:"col"},[i("ValidationProvider",{attrs:{name:"Modello",immediate:"",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[i("q-input",{attrs:{label:"Modello"},model:{value:e.selectedDevice.model,callback:function(t){e.$set(e.selectedDevice,"model",t)},expression:"selectedDevice.model"}}),i("span",{staticClass:"error"},[e._v(e._s(s[0]))])]}}])})],1)]),i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("ValidationProvider",{attrs:{name:"Indirizzo MAC",immediate:"",rules:"required|mac"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[i("q-input",{attrs:{label:"MAC"},model:{value:e.selectedDevice.mac,callback:function(t){e.$set(e.selectedDevice,"mac",t)},expression:"selectedDevice.mac"}}),i("span",{staticClass:"error"},[e._v(e._s(s[0]))])]}}])})],1),i("div",{staticClass:"col"},[i("ValidationProvider",{attrs:{name:"Indirizzo IP",immediate:"",rules:"required|ipv4"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[i("q-input",{attrs:{label:"ipv4"},model:{value:e.selectedDevice.ipv4,callback:function(t){e.$set(e.selectedDevice,"ipv4",t)},expression:"selectedDevice.ipv4"}}),i("span",{staticClass:"error"},[e._v(e._s(s[0]))])]}}])})],1),i("div",{staticClass:"col"},[i("ValidationProvider",{attrs:{name:"Tecnologia",immediate:"",rules:"ipv6"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[i("q-input",{attrs:{label:"ipv6"},model:{value:e.selectedDevice.ipv6,callback:function(t){e.$set(e.selectedDevice,"ipv6",t)},expression:"selectedDevice.ipv6"}}),i("span",{staticClass:"error"},[e._v(e._s(s[0]))])]}}])})],1)]),i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("q-input",{attrs:{label:"Note sul dispositivo",type:"textarea",rows:"5",cols:"20"},model:{value:e.selectedDevice.note,callback:function(t){e.$set(e.selectedDevice,"note",t)},expression:"selectedDevice.note"}})],1)])])],1),i("hr",{staticClass:"separator"}),i("div",[e.selectedDevice.objData?i("div",{attrs:{id:"deviceParametersPrimitives"}},[i("h6",[e._v("Parametri generali")]),e._l(e.objDataPrimitives,(function(t,s){return i("div",{key:t,staticClass:"row"},[i("div",{staticClass:"col"},[i("q-input",{attrs:{label:s,id:s},model:{value:e.selectedDevice.objData[s],callback:function(t){e.$set(e.selectedDevice.objData,s,t)},expression:"selectedDevice.objData[primitiveName]"}})],1)])}))],2):e._e(),i("hr",{staticClass:"separator"}),e.selectedDevice.objData?i("div",{attrs:{id:"deviceParametersSections"}},[i("h6",[e._v("Sezioni specifiche")]),e._l(e.objDataSection,(function(t,s,a){return i("div",{key:a},[i("h6",[i("p",{attrs:{align:"left"}},[e._v(e._s(s))])]),e._l(t,(function(t,a,c){return i("div",{key:c},[i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("q-input",{attrs:{label:a,id:a},model:{value:e.selectedDevice.objData[s][a],callback:function(t){e.$set(e.selectedDevice.objData[s],a,t)},expression:"selectedDevice.objData[sectionName][devPropertyName]"}})],1)])])})),i("hr",{staticClass:"separator"})],2)}))],2):e._e()])],1)},a=[],c=(s("e01a"),s("2f62")),o=s("4360"),l=s("7bb1"),r=(s("2ee0"),s("c933")),n={data(){return{selectedCustomer:{},selectedContract:{},selectedService:{},selectedDevice:{},selectedAsset:{},contractDescription:"",selectAssetOptions:[],companyassets:r,companyasset:{},devices:{},freeIps:[],objDataSection:{},objDataPrimitives:{}}},components:{ValidationProvider:l["b"],ValidationObserver:l["a"]},methods:{selectIpv4(e){this.selectedDevice.ipv4=e,this.selectedDevice.objData&&this.selectedDevice.objData.ip&&(this.selectedDevice.objData.ip=e)},getFreeIps(){console.log("Retrieve free ips"),this.$axios.post("/adminarea/deviceCustomer/getFreeIps").then((e=>{console.log(e),this.freeIps=e.data.freeIps}))},populateSelectAsset(){this.companyassets.forEach((e=>{this.selectAssetOptions.push({label:e.company+" -- "+e.techasset,value:e})}))},changeAsset(){this.objDataSection=[],this.objDataPrimitives=[],this.selectedDevice.objData={},this.companyasset=this.selectedAsset.value,console.log("Company asset"),console.log(this.companyasset),this.selectedDevice.type="Router",this.selectedDevice.description=this.customer.id+"-"+this.contract.id+"-"+this.service.id,this.selectedDevice.vendor=this.companyasset.vendor,this.selectedDevice.model=this.companyasset.model,this.selectedDevice.mac=this.companyasset.mac;Object.assign(this.selectedDevice.objData,this.companyasset.propDeviceStructure);this.selectedService=this.$store.state.service,console.log("Try to copy bandwith from service"),console.log(this.selectedService),this.selectedService.objData&&this.selectedService.objData.parameters&&this.selectedDevice.objData&&this.selectedDevice.objData.bandwith&&(console.log("Copy values in device parameters"),this.selectedDevice.objData.bandwith.upload_max=this.selectedService.objData.parameters.bandwidth_upload,this.selectedDevice.objData.bandwith.download_max=this.selectedService.objData.parameters.bandwidth_download,this.selectedDevice.objData.bandwith.upload_min=1e3,this.selectedDevice.objData.bandwith.download_min=1e3),console.log(this.selectedDevice),this.$store.commit("changeDeviceCustomer",this.selectedDevice),this.parseDeviceObjData()},parseDeviceObjData:function(){if(this.objDataSection={},this.objDataPrimitives={},this.selectedDevice&&this.selectedDevice.objData)for(const e in this.selectedDevice.objData)"object"===typeof this.selectedDevice.objData[e]?(console.log("Found object: "+e),this.objDataSection[e]=this.selectedDevice.objData[e]):(console.log("Found simple data: "+e),this.objDataPrimitives[e]=this.selectedDevice.objData[e])},getDeviceData:function(){this.selectedDevice=Object.assign({},this.$store.state.deviceCustomer),null===this.selectedDevice&&(this.selectedDevice={objData:{}}),null===this.selectedDevice.objData&&(this.selectedDevice={objData:{}}),this.$store.commit("changeDeviceCustomer",this.selectedDevice),this.parseDeviceObjData();const e=this.selectedDevice.companyasset,t=this.selectedDevice.techasset;console.log(e),console.log(t),console.log(this.selectAssetOptions),this.selectedAsset=this.selectAssetOptions.find((s=>e===s.value.company&&t===s.value.techasset)),console.log(this.selectedAsset)},newDevice(){this.selectedDevice={},this.$store.commit("changeDeviceCustomer",this.selectedDevice),this.makeToast("Configura un nuovo dispositivo")},saveDevice:function(){console.log(this.selectedAsset),this.selectedAsset&&this.selectedAsset.value?(this.companyasset=this.selectedAsset.value,this.companyasset&&(this.selectedDevice.companyasset=this.companyasset.company,this.selectedDevice.techasset=this.companyasset.techasset),this.selectedDevice.state="active",this.selectedDevice.contractId=this.contract.id,console.log(this.companyasset),this.$axios.post("/adminarea/deviceCustomer/update",{device:this.selectedDevice}).then((e=>{"OK"===e.data.status?(this.selectedDevice=e.data.deviceCustomer,this.$store.commit("changeDeviceCustomer",this.selectedDevice),this.makeToast(e.data.msg),this.getFreeIps()):this.makeToastError(e.data.msg)})).catch((e=>{this.makeToast(response.data.msg),console.log(e)}))):this.makeToastError("Seleziona un Asset in alto")},deleteDevice:function(){const e=confirm("Confermi la cancellazione?");e&&this.$axios.post("/adminarea/deviceCustomer/delete",{device:this.selectedDevice}).then((e=>{"OK"===e.data.status&&(this.selectedDevice=e.data.deviceCustomer,this.$store.commit("changeDeviceCustomer",this.selectedDevice),this.makeToast(e.data.msg),this.exit())})).catch((e=>{console.log(e)}))},exit:function(){this.$store.commit("changeDeviceCustomer",{}),this.$router.push("/Contract")},monitorDevice(){this.selectedDevice=Object.assign({},this.$store.state.deviceCustomer),this.selectedDevice&&("monitored"!==this.selectedDevice.monitored?this.selectedDevice.monitored="monitored":this.selectedDevice.monitored="",this.saveDevice())},makeToast(e){this.$q.notify({color:"green-4",textColor:"white",icon:"info",message:e})},makeToastError(e){this.$q.notify({color:"red-4",textColor:"white",icon:"info",message:e})}},computed:Object(c["b"])({user:"user",customer:"customer",contract:"contract",service:"service",device:"device",customerDescription(){const e=this.customer;return e.vatcode&&""!==e.vatcode?e.company:e.lastname+" "+e.firstname},monitorClassBackground(){return this.selectedDevice.monitored}}),mounted(){this.selectedCustomer=Object.assign({},this.$store.state.customer),this.selectedContract=Object.assign({},this.$store.state.contract),this.populateSelectAsset(),this.getDeviceData(),this.getFreeIps()},beforeRouteEnter(e,t,s){var i=o["a"].state.user;"admin"===i.role||"manager"===i.role||"technician"===i.role?s():s("/Login")}},d=n,v=(s("39d9"),s("2877")),h=s("0378"),u=s("ddd8"),m=s("27f9"),p=s("eebe"),D=s.n(p),b=Object(v["a"])(d,i,a,!1,null,"520c7a97",null);t["default"]=b.exports;D()(b,"components",{QForm:h["a"],QSelect:u["a"],QInput:m["a"]})}}]);