(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{"288c":function(e,t,i){"use strict";i("e062")},"65f9":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"siteBackbone"}},[s("d3-network",{attrs:{"net-nodes":e.nodesSiteBackbone,"net-links":e.linksSiteBackbone,options:e.optionsD3Component,selection:e.selectionsD3Component},on:{"node-click":e.onSiteClick}}),s("q-table",{attrs:{title:"Siti",data:e.sitesBackbone,columns:e.columnsTableSites,"row-key":"id",filter:e.siteFilter,"virtual-scroll":"",pagination:e.initialPagination,"rows-per-page-options":[0],"no-data-label":"nessun risultato","no-results-label":"nessun risultato"},on:{"row-click":e.openSiteBackbone},scopedSlots:e._u([{key:"top-right",fn:function(){return[s("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Ricerca"},model:{value:e.siteFilter,callback:function(t){e.siteFilter=t},expression:"siteFilter"}},[s("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1)]},proxy:!0},{key:"header",fn:function(t){return[s("q-tr",{attrs:{props:t}},[s("q-th",{attrs:{"auto-width":""}}),e._l(t.cols,(function(i){return s("q-th",{key:i.name,attrs:{props:t}},[e._v(e._s(i.label))])}))],2)]}},{key:"body",fn:function(t){return[s("q-tr",{class:t.row.state,attrs:{props:t}},[s("q-td",{attrs:{"auto-width":""}},[s("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:i("d8f6")},on:{click:function(i){return e.openSiteBackbone(t.row)}}}),e.selectedSiteBackbone.id?s("img",{staticStyle:{width:"32px",height:"32px",xfill:"gray"},attrs:{src:i("6371")},on:{click:function(i){return e.connectSiteBackbone(t.row)}}}):e._e(),s("img",{staticStyle:{width:"32px",height:"32px",xfill:"gray"},attrs:{src:i("c8ed")},on:{click:function(i){return e.deleteSiteBackbone(t.row)}}})]),e._l(t.cols,(function(i){return s("q-td",{key:i.name,attrs:{props:t}},[e._v(e._s(i.value))])}))],2)]}}])}),s("h5",[e._v("\n    Parametri sito\n    "),s("b",[e._v(e._s(e.selectedSiteBackbone.description))])]),s("img",{staticStyle:{width:"64px",height:"64px"},attrs:{src:i("f32a")},on:{click:function(t){return e.newSiteBackbone()}}}),s("img",{staticStyle:{width:"64px",height:"64px"},attrs:{src:i("40b4")},on:{click:function(t){return e.saveSiteBackbone()}}}),s("ValidationObserver",{ref:"formSite"},[s("q-form",{ref:"siteForm",staticClass:"q-gutter-md"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("ValidationProvider",{attrs:{name:"Descrizione",immediate:"",rules:"required|alpha_spaces"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.errors;return[s("q-input",{attrs:{label:"Descrizione"},model:{value:e.selectedSiteBackbone.description,callback:function(t){e.$set(e.selectedSiteBackbone,"description",t)},expression:"selectedSiteBackbone.description"}}),s("span",{staticClass:"error"},[e._v(e._s(i[0]))])]}}])})],1),s("div",{staticClass:"col"},[s("ValidationProvider",{attrs:{name:"Indirizzo",immediate:"",rules:"required|address"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.errors;return[s("q-input",{attrs:{label:"Indirizzo"},model:{value:e.selectedSiteBackbone.address,callback:function(t){e.$set(e.selectedSiteBackbone,"address",t)},expression:"selectedSiteBackbone.address"}}),s("span",{staticClass:"error"},[e._v(e._s(i[0]))])]}}])})],1)]),s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("ValidationProvider",{attrs:{name:"Latitudine",immediate:"",rules:"required|latitude"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.errors;return[s("q-input",{attrs:{label:"Latitude"},model:{value:e.selectedSiteBackbone.latitude,callback:function(t){e.$set(e.selectedSiteBackbone,"latitude",t)},expression:"selectedSiteBackbone.latitude"}}),s("span",{staticClass:"error"},[e._v(e._s(i[0]))])]}}])})],1),s("div",{staticClass:"col"},[s("ValidationProvider",{attrs:{name:"Longitudine",immediate:"",rules:"required|longitude"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.errors;return[s("q-input",{attrs:{label:"Longitude"},model:{value:e.selectedSiteBackbone.longitude,callback:function(t){e.$set(e.selectedSiteBackbone,"longitude",t)},expression:"selectedSiteBackbone.longitude"}}),s("span",{staticClass:"error"},[e._v(e._s(i[0]))])]}}])})],1)]),s("div",{staticClass:"row"},[s("q-input",{attrs:{label:"Note",type:"textarea",cols:"100",rows:"5"},model:{value:e.selectedSiteBackbone.note,callback:function(t){e.$set(e.selectedSiteBackbone,"note",t)},expression:"selectedSiteBackbone.note"}})],1)])],1),s("hr",{staticClass:"separator"}),e.isConnected?s("div",[s("h6",[e._v("Siti connessi")]),e._l(e.selectedSiteBackbone.objData.connectedSites,(function(t){return s("div",{key:t.id,staticClass:"row"},[s("div",{staticClass:"col"},[s("span",[e._v(e._s(t.description))])]),s("div",{staticClass:"col"},[s("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:i("d8f6"),alt:"apri"},on:{click:function(i){return e.openSiteBackbone(t)}}}),s("img",{staticStyle:{width:"32px",height:"32px",xfill:"gray"},attrs:{src:i("c8ed"),alt:"elimina"},on:{click:function(i){return e.disconnectSiteBackbone(t)}}})])])}))],2):e._e()],1)},a=[],o=(i("e01a"),i("a5b7")),n=i.n(o),c=i("2f62"),l=i("4360"),r=i("7bb1"),d=(i("2ee0"),{components:{D3Network:n.a,ValidationProvider:r["b"],ValidationObserver:r["a"]},data(){return{isConnected:!1,siteFilter:"",initialPagination:{sortBy:"desc",descending:!1,page:2,rowsPerPage:5},columnsTableSites:[{name:"actions",label:"Azioni"},{name:"description",label:"Descrizione",field:e=>e.description,sortable:!0},{name:"address",label:"indirizzo",field:e=>e.address,sortable:!0},{name:"longitude",label:"Longitudine",field:e=>e.username,sortable:!0},{name:"latitude",label:"Latitudine",field:e=>e.mobilephone,sortable:!0},{name:"Note",label:"note",field:e=>e.note,sortable:!0}],selectionsD3Component:{nodes:[],links:[]},optionsD3Component:{force:3e3,size:{w:800,h:1e3},nodeSize:30,linkWidth:4,fontSize:12,nodeLabels:!0,linkLabels:!1,canvas:!1},nodesSiteBackbone:[],linksSiteBackbone:[],selectedSiteBackbone:{},sitesBackbone:[],linksBackbone:{},objDataSection:{},objDataPrimitives:{}}},mounted(){this.getSiteBackboneData(),this.getAllSitesBackbone(),this.totalRows=this.sitesBackbone.length},methods:{initD3Component(){this.nodesSiteBackbone=[],this.linksSiteBackbone=[],this.selectionsD3Component={nodes:[],links:[]},this.sitesBackbone&&this.sitesBackbone.forEach((e=>{let t="blue";if(e.id===this.selectedSiteBackbone.id&&(t="orange"),this.nodesSiteBackbone.push({id:e.id,name:e.description,_color:t}),e.objData&&e.objData.connectedSites){const t=e.objData.connectedSites;t&&t.forEach((t=>{let i="blue";e.id!==this.selectedSiteBackbone.id&&t.id!==this.selectedSiteBackbone.id||(i="orange"),this.linksSiteBackbone.push({sid:e.id,tid:t.id,_color:i})}))}}))},onSiteClick(e,t){this.sitesBackbone.forEach((e=>{e.id===t.id&&this.openSiteBackbone(e)}))},getAllSitesBackbone:function(){this.$axios.post("/adminarea/siteBackbone/getall",{}).then((e=>{"OK"===e.data.status&&(this.sitesBackbone=e.data.sitesBackbone,this.totalRows=this.sitesBackbone.length,this.makeToast(e.data.msg),this.initD3Component())})).catch((e=>{console.log(e)}))},getSiteBackboneData:function(){this.selectedSiteBackbone=Object.assign({},this.$store.state.siteBackbone)},parseSiteBackboneObjData:function(){if(this.selectedSiteBackbone.objData)for(const e in this.selectedSiteBackbone.objData)"object"===typeof this.selectedSiteBackbone.objData[e]?this.objDataSection[e]=this.selectedSiteBackbone.objData[e]:this.objDataPrimitives[e]=this.selectedSiteBackbone.objData[e]},disconnectSiteBackbone(e){e&&this.selectedSiteBackbone&&this.selectedSiteBackbone.objData.connectedSites.forEach(((t,i,s)=>{t.id===e.id&&(this.selectedSiteBackbone.objData.connectedSites.splice(i,1),this.saveSiteBackbone())}))},connectSiteBackbone(e){if(this.selectedSiteBackbone&&e)if(this.selectedSiteBackbone.objData||(this.selectedSiteBackbone.objData={}),this.selectedSiteBackbone.objData.connectedSites||(this.selectedSiteBackbone.objData.connectedSites=[]),0===this.selectedSiteBackbone.objData.connectedSites.length)this.selectedSiteBackbone.objData.connectedSites.push(e),this.saveSiteBackbone();else{const t=this.selectedSiteBackbone.objData.connectedSites.some((t=>t.id===e.id));t?this.makeToast("Sito giÃ  collegato"):(this.selectedSiteBackbone.objData.connectedSites.push(e),this.saveSiteBackbone())}},openSiteBackbone(e){this.selectedSiteBackbone=e,this.$store.commit("changeSiteBackbone",Object.assign({},e)),this.makeToast("Sito aperto per la modifica"),this.initD3Component()},newSiteBackbone(){this.$axios.post("/adminarea/siteBackbone/insert",{siteBackbone:this.selectedSiteBackbone}).then((e=>{"OK"===e.data.status?(this.selectedSiteBackbone=e.data.siteBackbone,this.makeToast(e.data.msg),this.sitesBackbone=[this.selectedSiteBackbone],this.$store.commit("changeSelectedSite",Object.assign({},this.sitesBackbone))):this.makeToast(e.data.msg)})).catch((e=>{console.log(e)}))},saveSiteBackbone:function(){this.$axios.post("/adminarea/siteBackbone/update",{siteBackbone:this.selectedSiteBackbone}).then((e=>{"OK"===e.data.status?(this.selectedSiteBackbone=e.data.siteBackbone,this.getAllSitesBackbone(),this.makeToast(e.data.msg),this.$store.commit("changeSelectedSite",Object.assign({},this.selectedSiteBackbone))):this.makeToast(e.data.msg,"danger")})).catch((e=>{console.log(e)}))},deleteSiteBackbone:function(e){const t=confirm("Confermi la cancellazione?");t&&this.$axios.post("/adminarea/siteBackbone/delete",{siteBackbone:e}).then((e=>{"OK"===e.data.status?(this.selectedSiteBackbone=e.data.siteBackbone,this.makeToast(e.data.msg),this.getAllSitesBackbone(),this.$store.commit("changeSelectedSite",Object.assign({},this.selectedSiteBackbone))):this.makeToast(e.data.msg,"danger")})).catch((e=>{console.log(e)}))},makeToast(e){this.$q.notify({color:"green-4",textColor:"white",icon:"info",message:e})}},computed:Object(c["b"])({user:"user"}),beforeRouteEnter(e,t,i){var s=l["a"].state.user;console.log(s),"admin"===s.role||"manager"===s.role||"technician"===s.role?i():i("/Login")}}),b=d,k=(i("8c17"),i("288c"),i("2877")),h=i("eaac"),u=i("27f9"),S=i("0016"),p=i("bd08"),B=i("357e"),m=i("db86"),f=i("0378"),g=i("eebe"),v=i.n(g),D=Object(k["a"])(b,s,a,!1,null,"2a439478",null);t["default"]=D.exports;v()(D,"components",{QTable:h["a"],QInput:u["a"],QIcon:S["a"],QTr:p["a"],QTh:B["a"],QTd:m["a"],QForm:f["a"]})},e062:function(e,t,i){}}]);